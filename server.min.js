const express=require("express"),playerFile=require("./serverFiles/player"),timeFile=require("./serverFiles/time"),Player=playerFile.Player,Weapon=require("./serverFiles/weapon").Weapon,Ammunition=require("./serverFiles/weapon").Ammunition,interpeter=require("./serverFiles/text").interpeter,Bullet=require("./serverFiles/bullet").Bullet,Chest=require("./serverFiles/chest").Chest,Hitbox=require("./serverFiles/hitbox").Hitbox,Enemy=require("./serverFiles/enemy").Enemy,mapFile=require("./serverFiles/map"),BlockFile=require("./serverFiles/block"),InvetoryFile=require("./serverFiles/invetory"),SpellFile=require("./serverFiles/spell"),Spell=SpellFile.Spell,SpellsBuffer=SpellFile.SpellsBuffer,renewMagicEnergy=SpellFile.renewMagicEnergy,Invetory=InvetoryFile.Invetory,Slot=InvetoryFile.Slot,Recipe=InvetoryFile.Recipe,createItemsFromRecipe=InvetoryFile.createItemsFromRecipe,fillInvetoryWithSlots=InvetoryFile.fillInvetoryWithSlots,Item=InvetoryFile.Item,Block=BlockFile.Block,createBlock=BlockFile.createBlock,createBlocksWithGrid=BlockFile.createBlocksWithGrid,checkCollisionWith=require("./serverFiles/hitbox").checkCollisionWith,Timer=timeFile.Timer,Tick=timeFile.Tick,clearTimerCache=timeFile.clearTimerCache,timeLoop=timeFile.timeLoop,GameMap=mapFile.GameMap,Chunk=mapFile.Chunk,generatePlane=mapFile.generatePlane,loadMap=mapFile.loadMap,app=express(),http=require("http"),server=http.createServer(app),fs=require("fs"),{networkInterfaces:$}=require("os"),Version=require("./version");console.log("Server version:",Version.version),console.log("Compabityle with:",Version.accessWith);const nets=$(),results=Object.create(null);for(const name of Object.keys(nets))for(const net of nets[name]){let e="string"==typeof net.family?"IPv4":4;net.family!==e||net.internal||(results[name]||(results[name]=[]),results[name].push(net.address))}function onErr($){return console.log($),1}console.log(results),server.listen(16450,"0.0.0.0",()=>{console.log("Server start")});const{Server:t}=require("socket.io"),io=new t(server),house01TileObject=[8,12,12,12,12,9,10,12,12,12,12,11,10,12,12,12,12,11,10,12,12,12,12,11,13,6,4,4,6,14,3,4,4,4,4,5,3,4,6,6,4,5,3,4,1,2,4,5],house02TileObject=[0,0,8,12,12,12,12,9,0,0,0,8,10,12,12,12,12,11,9,0,8,10,13,6,4,7,6,14,11,9,10,13,4,7,4,4,7,4,14,11,13,4,4,6,4,4,6,4,5,14,3,7,4,4,7,4,4,4,7,5,3,4,7,4,4,4,7,4,7,5,3,3,1,3,6,6,5,2,4,5],mapFirstLayer=[5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],mapSecondLayer=[37,38,0,48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,28,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,39,40,0,0,0,0,33,0,0,48,0,0,0,0,0,0,0,0,37,38,0,48,0,0,0,0,0,0,0,0,0,0,0,0,0,37,38,0,48,0,0,0,0,0,0,0,0,0,41,42,0,0,0,0,0,0,0,0,0,28,0,0,0,0,0,0,39,40,0,0,0,0,33,0,0,48,0,0,0,0,0,0,0,39,40,0,0,0,0,33,0,0,48,0,0,0,43,44,0,0,46,48,0,0,0,48,0,0,46,0,48,0,0,0,41,42,0,0,0,0,0,0,0,0,0,28,48,0,0,0,48,41,42,46,0,48,0,0,0,0,0,0,28,0,0,0,0,0,0,0,0,0,0,0,0,0,33,0,0,0,0,28,43,44,0,0,46,0,0,0,0,0,0,0,0,0,0,0,0,43,44,0,0,46,0,0,28,0,0,0,0,0,48,0,0,0,37,38,36,48,0,49,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,37,38,0,48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,33,0,0,0,0,39,40,0,0,0,0,33,0,0,16,0,0,0,0,48,0,0,0,0,0,36,0,0,49,0,39,40,0,0,0,0,48,0,0,48,0,0,36,0,0,49,0,0,0,0,0,0,25,41,42,0,0,37,38,0,0,0,0,0,28,0,0,0,0,0,0,0,0,0,0,0,0,0,41,42,16,0,0,0,0,0,0,0,0,28,0,0,0,0,0,0,0,0,0,0,0,43,44,0,0,39,40,0,0,0,0,0,0,0,0,0,0,37,38,0,0,0,0,37,38,0,43,44,0,0,46,0,0,0,0,25,0,0,0,0,37,38,0,0,0,0,0,0,0,0,49,0,0,41,42,0,0,25,0,0,0,33,0,0,0,39,40,0,0,0,0,39,40,0,0,0,0,0,0,0,0,0,0,0,0,0,33,0,39,40,0,0,0,0,0,0,0,48,0,0,0,43,44,36,0,0,49,0,0,0,0,0,0,41,42,0,49,0,0,41,42,0,48,25,0,0,0,0,36,0,0,49,0,49,0,0,41,42,0,0,25,0,0,25,0,0,0,0,0,0,0,0,0,0,0,0,0,37,38,0,0,43,44,0,0,0,0,43,44,0,37,38,0,0,0,0,0,0,0,0,0,0,0,16,43,44,0,0,0,48,0,0,0,0,0,0,25,14,0,0,0,37,38,0,0,39,40,0,0,25,0,0,0,0,0,0,0,0,39,40,0,25,0,0,0,0,37,38,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,39,40,0,0,41,42,48,0,0,37,38,0,0,0,14,0,0,41,42,0,0,0,0,48,0,39,40,0,0,0,0,14,0,0,0,0,0,0,0,0,0,0,0,0,0,49,0,0,41,42,0,0,43,44,0,0,0,39,40,0,37,38,37,38,0,43,44,0,0,0,49,0,0,41,42,0,0,25,0,37,38,0,0,0,0,0,33,0,0,0,0,0,0,0,0,0,43,44,0,0,0,0,0,0,0,41,42,0,39,40,39,40,0,0,0,0,0,0,0,0,0,43,44,0,0,0,0,39,40,0,0,0,0,0,0,0,0,0,25,0,0,0,0,0,0,0,0,37,38,48,0,0,0,43,44,0,41,42,41,42,0,0,0,37,38,0,0,0,0,0,0,0,0,0,0,41,42,0,0,0,0,0,0,0,48,0,0,0,0,0,0,0,14,5,0,39,40,0,0,37,38,0,0,0,43,44,43,44,0,28,0,39,40,0,0,0,0,14,0,0,0,0,0,43,44,0,0,0,0,0,0,0,0,37,38,0,0,0,0,0,0,37,38,41,42,37,38,39,40,0,37,38,0,0,0,0,0,0,0,41,42,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,39,40,0,0,0,0,37,38,39,40,43,44,39,40,41,42,0,39,40,0,48,0,0,0,0,0,43,44,0,0,0,0,0,0,0,0,0,0,37,38,0,0,0,0,0,0,0,0,41,42,0,0,0,0,39,40,41,42,37,38,41,42,43,44,0,41,42,0,37,38,28,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,39,40,0,0,0,0,0,0,0,0,43,44,0,0,0,0,41,42,43,44,39,40,43,44,0,46,0,43,44,0,39,40,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,41,42,0,0,0,0,0,0,0,0,0,0,0,0,0,0,43,44,0,0,41,42,0,0,37,38,0,0,0,0,41,42,0,33,0,0,0,0,0,0,0,0,0,37,38,0,0,0,43,44,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,43,44,0,0,39,40,0,36,0,0,43,44,0,0,0,37,38,0,0,0,0,0,0,39,40,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,37,38,0,0,0,0,0,0,0,0,41,42,0,0,0,0,0,0,0,0,16,39,40,0,0,0,0,0,0,41,42,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,39,40,0,0,0,0,0,0,0,0,43,44,0,0,0,37,38,0,0,0,0,41,42,0,0,0,0,0,0,43,44,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,41,42,0,0,0,0,0,0,0,0,0,0,0,0,0,39,40,0,0,0,0,43,44,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,43,44,0,37,38,0,0,0,37,38,0,0,49,0,0,41,42,0,0,25,0,48,0,0,0,48,0,0,46,0,48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,39,40,33,0,0,39,40,0,0,0,0,0,43,44,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,28,0,0,0,0,0,0,0,0,0,0,48,0,0,0,48,0,0,41,42,48,0,0,41,42,0,0,0,0,0,0,0,0,0,0,37,38,0,48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,43,44,0,0,48,43,44,0,0,0,0,0,14,0,0,0,0,39,40,0,0,0,0,33,0,0,48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,41,42,0,0,0,0,0,0,0,0,0,28,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,33,0,0,48,0,0,0,0,0,0,0,48,0,0,0,48,0,0,46,43,48,0,0,46,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,0,0,0,0,0,0,46,0,48,0,0,0,0,28,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,28,0,0,0,0,0,0,0,33,0,0,0,0,0,0,0,0,0,0,0,0,0,0,46,0,0,0,0,28,0,0,0,0,0,0,37,38,0,48,0,0,0,0,0,48,0,0,0,0,0,48,0,0,49,48,0,0,46,0,48,0,0,0,37,38,0,48,0,0,0,0,0,0,0,0,0,0,0,0,33,0,0,0,39,40,0,0,0,0,33,0,0,48,0,0,0,0,0,0,0,0,0,0,0,0,16,0,0,0,0,28,39,40,0,0,48,0,33,0,0,48,36,0,0,49,0,0,0,0,0,0,41,42,0,0,0,0,0,0,0,0,0,28,25,0,37,38,0,37,38,0,0,0,0,0,0,0,0,0,41,42,0,0,0,0,0,0,0,0,0,28,0,0,0,0,0,16,0,0,43,44,0,0,46,0,0,0,0,0,0,0,0,0,39,40,0,39,40,0,33,0,0,48,0,0,0,0,43,44,0,0,46,0,0,25,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,33,0,41,42,0,41,42,0,0,25,0,0,0,28,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,0,0,0,0,0,36,33,0,49,0,0,0,0,43,44,0,43,44,0,0,0,0,0,0,0,0,0,48,0,0,0,0,0,36,0,0,49,0,0,0,0,0,0,25,0,0,0,0,0,0,0,0,0,0,0,0,0,0,25,0,16,0,0,0,0,0,0,0,0,0,0,0,0,33,0,0,0,33,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,25,0,0,0,0,37,38,0,0,0,0,48,0,0,14,0,0,36,0,0,49,0,0,0,0,0,0,0,25,0,0,25,0,37,38,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,39,40,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16,0,0,0,0,48,0,0,0,39,40,0,0,14,0,0,0,0,0,0,0,0,0,0,0,0,49,0,0,41,42,0,0,25,0,0,0,0,25,0,0,0,0,37,38,0,0,0,0,0,0,0,0,0,49,0,0,41,42,0,0,25,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,43,44,0,0,0,0,0,0,0,0,0,0,0,0,39,40,0,0,0,0,0,0,0,0,0,0,0,0,43,44,0,0,0,0,0,0,0,0,0,0,0,0,25,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,49,0,0,41,42,0,0,25,0,0,0,25,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,0,0,0,0,0,0,0,14,0,0,0,0,0,0,0,0,0,0,0,0,0,43,44,0,0,0,0,48,0,0,0,0,0,0,0,14,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,25,0,0,0,0,0,0,0,0,0,0,0];console.log("Environment"),console.log("NodeJs Version: "+process.version),console.log("Version: "+process.env.npm_package_version);let gameAttackList=[];const trialAmmunition1="Pistol/Caliber9mm/Pistolet XD",trialAmmunition2="Crosbow/ArrowHeadSize20mm/Kusza z XIV wieku",trialAmmunition3="Rifle/Caliber12mm/Adminowy Karabin Maszynowy",trialAmmunition4="Pistol/Caliber12mm/Pistolet XD",newAmmo=new Ammunition("Pistol/Caliber9mm/Pistolet XD",1,"bullet",20),newWeapon=new Weapon("Pistolet",2,4,1,20,80,"distance",2,newAmmo),ammunitions=[new Ammunition("Pistol/Caliber9mm/Pistolet XD",1.1,"bullet",20),new Ammunition("Crosbow/ArrowHeadSize20mm/Kusza z XIV wieku",3.8,"bullet",3),new Ammunition("Rifle/Caliber12mm/Adminowy Karabin Maszynowy",2,2,"bullet",50)],blockHitboxPrecision=4,gameTimer=new Timer,GameObjects={map:new GameMap,bullets:[],chests:[],enemies:[],blocks:[]},items=[new Item("Test01",3,0,"test01",!1),new Item("Test02",7,0,"test02",!1),new Item("Żelazo",7,0,"Żelazo",!1),new Item("Drewno",7,0,"Drewno",!1),new Item("Mały miecz",7,0,"weapon",!1)],recipes=[new Recipe("Mały miecz",[{item:items[2],amount:1},{item:items[3],amount:1}],[{item:items[4],amount:1}],0)];console.log(recipes),GameObjects.chests.push(new Chest(1500,800,25,25,new Hitbox(1500,800,25,25),structuredClone(items[2]))),GameObjects.chests[0].content.amount=1;const weapons=[new Weapon("Pistolet",1,3,1,20,20,"distance",3,structuredClone(ammunitions[0]),90),new Weapon("Młot",24,34,1,20,350,"melee"),new Weapon("Mały Miecz",6,13,1,20,240,"melee"),new Weapon("Kusza",9,14,1,20,20,"distance",2,structuredClone(ammunitions[1]),80)],spells=[new Spell("Błyskawica",18,"dmg","thunderboltAttack","enemy:1",2,14,18),new Spell("Kula Ognia",2,"dmg","ballOfFire","direction:hitenemy:1",1,16,35),new Spell("Magiczna pułapka",24,"dmg","magicTrap","direction:hitenemy:1",2.6,12,27),new Spell("Niepamięć",23,"time","oblivion","enemy:1",7,null,null,4)];GameObjects.enemies.push(new Enemy(0,450,80,50,65,40,40,weapons[3],new Hitbox(void 0,void 0,50,65),1,1,structuredClone(items[1]),1,0,[structuredClone(ammunitions[1])])),console.log(GameObjects.enemies[0]),GameObjects.enemies[0].secondAiState="icanshoot?",GameObjects.enemies[0].ammunition[0].allAmmunition=15,createBlocksWithGrid(800,50,64,64,house02TileObject,10,8,GameObjects),createBlocksWithGrid(1500,80,64,64,house01TileObject,6,8,GameObjects),createBlocksWithGrid(2570,90,64,64,house02TileObject,10,8,GameObjects),generatePlane(3,GameObjects.map,1024,1024),loadMap(GameObjects.map,3,mapFirstLayer,mapSecondLayer,GameObjects),GameObjects.chests.push(new Chest(2200,2200,25,25,new Hitbox(2200,2200,25,25),"nothing","chest"));let gameState="off",players=[],gamePlayers=[],countOfPlayers=0;const maxCountOfPlayers=2;let whereToGo=0;function writeToLog($){let e=new Date,t="Day:"+e.getDate()+"-"+e.getHours()+":"+e.getMinutes()+":"+e.getSeconds();fs.writeFile("logs.txt",t+"=>"+$+"\n",{flag:"a"},$=>{$&&console.error($)})}function updateGameState(){let $=0;for(let e of gamePlayers)"yesPlay"===e.state&&$++;if(countOfPlayers>=1&&$>=1)gameState="play",io.emit("send-game-state","play");else{gameState="off";let t=countOfPlayers-1;io.emit("send-info","Other players:"+t+"<br>To play required minimum two players with active status")}}function clientVersionIsGood($){$.emit("get-version",($=!1,e)=>{console.warn($),console.log("We must",e),isUndefined(e)&&console.error("DA")})}function convertNumberToPercent($,e){return $/e*100}function bulletsLoop(){let $=gameTimer.listOfTicks;for(let e of $)if("Creating a Bullet"===e.nameOfTick.substr(0,17)&&e.done&&!e.old){let t=interpeter(e.nameOfTick);for(let i of(t[0]=parseInt(t[0].substring(2)),t[1]=parseInt(t[1].substring(2)),t[2]=parseInt(t[2].substring(6)),t[3]=parseInt(t[3].substring(7)),t[4]=parseInt(t[4].substring(6)),t[5]=parseInt(t[5].substring(7)),t[6]=parseInt(t[6].substring(7)),t[7]=parseInt(t[7].substring(8)),t[8]=parseInt(t[8].substring(8)),t[9]=t[9].substring(6),GameObjects.bullets.push(new Bullet(t[0],t[1],t[2],t[3],new Hitbox(t[0],t[1],t[2],t[3]),t[4],t[5],t[6],t[7],t[8],t[9],600)),e.old=!0,GameObjects.bullets)){for(let o of gamePlayers)i.owner===o.id&&i.checkTheDirection(o);for(let s of GameObjects.enemies)i.owner==="Enemy"+s.id&&i.checkTheDirection(s)}break}}function updateHitboxs(){for(let $ of GameObjects.bullets)$.hitbox.x=$.x,$.hitbox.y=$.y;for(let e of GameObjects.chests)e.hitbox.x=e.x,e.hitbox.y=e.y;for(let t of gamePlayers)t.hitbox.x=t.x,t.hitbox.y=t.y;for(let i of GameObjects.enemies)i.hitboxActive&&(i.hitbox.x=i.x,i.hitbox.y=i.y)}function playerLoop(){for(let $ of gamePlayers){let{movingSpeed:e,x:t,y:i,width:o,height:s,spellsBuffer:l}=$,a=$.movingDirectionAxisX,n=$.movingDirectionAxisY,r=l.spells.length;for(let m=0;m<r;m++)l.reloadsTimes[m]-=15,l.reloadsTimes[m]<=0&&(l.reloadsTimes.splice(m,1),l.spells.splice(m,1));for(let c of("Left"===$.movingDirectionAxisX?$.x-=e:"Right"===$.movingDirectionAxisX?$.x+=e:"Up"===$.movingDirectionAxisY?$.y-=e:"Down"===$.movingDirectionAxisY&&($.y+=e),GameObjects.blocks))if(checkCollisionWith(c.hitbox,$.hitbox)){"Left"===a&&$.x>c.x&&($.x+=e),"Right"===a&&$.x<c.x&&($.x-=e),"Up"===n&&$.y>c.y&&($.y+=e),"Down"===n&&$.y<c.y&&($.y-=e);break}}}function gameLoop(){if("play"===gameState){updateHitboxs();let $=[];for(let e=0;e<gamePlayers.length;e++)"noPlay"!==gamePlayers[e].state&&"spectator"!==gamePlayers[e].state&&$.push(gamePlayers[e]);for(let t of gamePlayers)"noPlay"!==t&&"spectator"!==t.state&&t.hp<=0&&(t.isAlive=!1),GameObjects.bullets.forEach(($,e)=>{if(checkCollisionWith(t.hitbox,$.hitbox)&&$.owner!==t.id){let i=Math.floor(Math.random()*($.maxDmg-$.minDmg+1)+$.minDmg);t.hp-=i,GameObjects.bullets.splice(e,1)}});for(let i of GameObjects.enemies)i.choosePlayer(gamePlayers),i.enemyAi(gameAttackList,i.objectivePlayer,gameTimer,GameObjects.chests,GameObjects.bullets,GameObjects.blocks),"dodge"!==i.aiState&&("distance"===i.weapon.type&&"shooting"!==i.aiState&&(i.secondAiState="icanshoot?"),"distance"===i.weapon.type&&"shooting"!==i.aiState&&"oblivion"!==i.aiState?i.aiState="quest":"distance"!==i.weapon.type&&"oblivion"!==i.aiState&&(i.aiState="quest"));GameObjects.bullets.forEach(($,e)=>{for(let t of($.move(),$.speed<=0&&GameObjects.bullets.splice(e,1),GameObjects.enemies))if(checkCollisionWith($.hitbox,t.hitbox)&&t.hitboxActive&&20===$.owner.length){let i=Math.floor(Math.random()*($.maxDmg-$.minDmg+1)+$.minDmg);t.hp-=i,GameObjects.bullets.splice(e,1)}for(let o of GameObjects.blocks)checkCollisionWith(o.hitbox,$.hitbox)&&GameObjects.bullets.splice(e,1)});let o=gameTimer.listOfTicks;for(let s of o)if("Player attack"===s.nameOfTick.substr(0,13)&&s.done&&!s.old){let l=interpeter(s.nameOfTick);l[0]=l[0].substring(3),l[1]=parseInt(l[1].substring(4));let a=gamePlayers.filter($=>$.id===l[0])[0];for(let n of gamePlayers)void 0!==a&&a!==n&&checkCollisionWith(a.hitbox,n.hitbox)&&(n.hp-=l[1]);for(let r of GameObjects.enemies)void 0!==a&&checkCollisionWith(a.hitbox,r.hitbox)&&(r.hp-=l[1]);s.old=!0}else if("Reloading a player distance weapon"===s.nameOfTick.substr(0,34)&&s.done&&!s.old){console.log(s.nameOfTick.substr(0,34),s.nameOfTick.substr(34).split(",")[0],s.nameOfTick.substr(34).split(",")[1]);let m=s.nameOfTick.substr(34).split(",")[1],c=gamePlayers.filter($=>$.id===s.nameOfTick.substr(34).split(",")[0])[0];c.ammunition[m].reloading=!1,console.log(c.ammunition[m].actualAmmunition,c.ammunition[m],c.ammunition[m].maxMagazine),c.ammunition[m].actualAmmunition=c.ammunition[m].actualAmmunition+Math.min(c.ammunition[m].allAmmunition,c.ammunition[m].maxMagazine),s.old=!0}else if("Reloading a enemy distance weapon"===s.nameOfTick.substr(0,33)&&s.done&&!s.old){console.log(s.nameOfTick.substr(0,33),s.nameOfTick.substr(33).split(",")[0],s.nameOfTick.substr(33).split(",")[1]);let u=s.nameOfTick.substr(33).split(",")[1],p=GameObjects.enemies.filter($=>$.id===Number(s.nameOfTick.substr(33).split(",")[0]))[0];console.log(s.nameOfTick.substr(33).split(",")[0]),console.log(GameObjects.enemies[0].id),p.ammunition[u].reloading=!1,console.log(p.ammunition[u]),console.log(p.ammunition[u].actualAmmunition,p.ammunition[u],p.ammunition[u].maxMagazine),p.ammunition[u].actualAmmunition=p.ammunition[u].actualAmmunition+Math.min(p.ammunition[u].allAmmunition,p.ammunition[u].maxMagazine),s.old=!0}else for(let _ of GameObjects.enemies)if(s.nameOfTick==="EnemyLightAttack EnemyId:"+_.id&&s.done&&!s.old){let b=gamePlayers.map($=>$.id).indexOf(_.objectivePlayer.id);_.weapon.attack(_,null,gameTimer,gamePlayers[b],"enemy"),s.old=!0}io.emit("send-bullets",GameObjects.bullets),io.emit("send-chests",GameObjects.chests),io.emit("send-enemies",GameObjects.enemies),io.emit("send-players",gamePlayers),clearTimerCache(gameTimer)}}app.get("/",($,e)=>{e.sendFile("index.html",{root:"public"})}),app.use(express.static("public")),io.on("connection",$=>{writeToLog("User with id:"+$.id+" connect with server."),io.emit("send-info","Other players:"+countOfPlayers);let e={host:$.handshake.headers.host,state:"connected"};io.emit("send-status-server",e),setInterval(updateGameState,1e3),writeToLog("User with id:"+$.id+" connect with server."),$.on("enter-to-game",e=>{writeToLog("User with id:"+e.name+" go to game."),writeToLog("Checking client version...");new Weapon("Sztylet",8,14,1,80,15,"melee",2);let t=new Invetory,i=new SpellsBuffer;t.basicSlots.length=30,fillInvetoryWithSlots(t),t.basicSlots[0].content=items[2],t.basicSlots[1].content=items[3],t.basicSlots[0].amount=3,t.basicSlots[1].amount=2;let o=new Player($.id,$.id,"PvP",1500,800,50,65,100,100,weapons[3],new Hitbox(1500,800,50,65),3,250,280,[structuredClone(ammunitions[1])],t,i,structuredClone(spells),structuredClone(recipes));o.state=e.state,o.name=e.name,o.ammunition[0].allAmmunition=15,players.push(o),gamePlayers.push(players[whereToGo]),$.emit("assign-player",players[whereToGo]),countOfPlayers++,whereToGo++}),$.on("client-version",$=>{}),$.on("set-player-move-target",e=>{for(let t of gamePlayers)$.id===t.id&&(t.targetX=e.x,t.targetY=e.y)}),$.on("change-moving-state",e=>{for(let t of gamePlayers)$.id===t.id&&(t.moving=e)}),$.on("request-cursor-mode",e=>{for(let t of gamePlayers)if($.id===t.id){for(let i of spells)if(i.name===t.actualSpell){console.log("Player:",t.actualSpell,"Finded:",i.name);let o=i.bewitch(e,t,"player",t.spellsBuffer);$.emit("change-cursor-state",o)}}}),$.on("spell-marking",e=>{for(let t of(console.log(e),gamePlayers))if($.id===t.id){let i;for(let o of spells)if(t.actualSpell===o.name){i=o;break}if("enemy"===i.availablesObjects.substr(0,5)){let s=GameObjects.enemies.concat(gamePlayers);for(let l of($.emit("change-cursor-state","auto"),console.log(s.length,GameObjects.enemies.length+gamePlayers.length),s)){let a=checkCollisionWith(e,l.hitbox);if(a){if($.emit("change-cursor-state","auto"),t.magicEnergy-=i.requiredMagicEnergy,"thunderboltAttack"===i.action)console.log("AA"),i.completeSpell(l),t.spellsBuffer.spells.push("thunderboltAttack"),t.spellsBuffer.reloadsTimes.push(1e3*i.reload),console.log(t.spellsBuffer.reloadsTimes,t.spellsBuffer.spells);else if("oblivion"===i.action&&void 0!==l.aiState){let n=l.aiState,r=l.secondAiState;l.aiState="oblivion",l.secondAiState="oblivion",t.spellsBuffer.spells.push("oblivion"),t.spellsBuffer.reloadsTimes.push(1e3*i.reload),setTimeout(()=>{console.log(l.aiState)},100),setTimeout(()=>{l.aiState=n,l.secondAiState=r},1e3*i.time)}}}}else if("direction"===i.availablesObjects.substr(0,9)){let{action:m,minDmg:c,maxDmg:u}=i,p,_;if("direction"===i.availablesObjects.substr(0,9)){for(let b of("ballOfFire"===m?(p=50,_=50):"magicTrap"===m&&(_=25,p=25),t.magicEnergy-=i.requiredMagicEnergy,t.spellsBuffer.spells.push(i.action),t.spellsBuffer.reloadsTimes.push(1e3*i.reload),GameObjects.bullets.push(new Bullet(t.x,t.y,p,_,new Hitbox(t.x,t.y,p,_),2,c,u,e.x,e.y,t.id,560)),console.log(GameObjects.bullets[GameObjects.bullets.length-1]),"magicTrap"===m&&(GameObjects.bullets[GameObjects.bullets.length-1].getMove=!1,GameObjects.bullets[GameObjects.bullets.length-1].distance=1),GameObjects.bullets))console.log(b),b.owner===t.id&&(console.log("TRUE",t,"TRUE"),b.checkTheDirection(t));$.emit("change-cursor-state","moving")}}}}),$.on("player-attack",e=>{for(let t of gamePlayers)$.id===t.id&&"spectator"!==t.state&&t.attack(e,gameTimer)}),$.on("player-open-chest",e=>{for(let t of gamePlayers)if($.id===t.id&&"spectator"!==t.state)for(let i of GameObjects.chests)checkCollisionWith(t.hitbox,i.hitbox)&&(i.open(t,t.invetory),console.log("Player with name:"+t.name+" (id)"+t.id+"open the chest."))}),$.on("player-change-weapon",e=>{for(let t of gamePlayers)$.id===t.id&&"spectator"!==t.state&&(t.weapon=weapons[t.weaponCounter],t.weaponCounter++,4===t.weaponCounter&&(t.weaponCounter=0))}),$.on("player-change-spell",e=>{for(let t of gamePlayers)$.id===t.id&&"spectator"!==t.state&&(t.actualSpell=spells[t.spellCounter].name,t.spellCounter++,4===t.spellCounter&&(t.spellCounter=0))}),$.on("player-start-move",e=>{for(let t of gamePlayers)$.id===t.id&&"spectator"!==t.state&&(87===e?t.movingDirectionAxisY="Up":83===e?t.movingDirectionAxisY="Down":65===e?t.movingDirectionAxisX="Left":68===e&&(t.movingDirectionAxisX="Right"))}),$.on("player-stop-move",e=>{for(let t of gamePlayers)$.id===t.id&&"spectator"!==t.state&&(87===e||83===e?t.movingDirectionAxisY="None":(65===e||68===e)&&(t.movingDirectionAxisX="None"))}),$.on("update-object",e=>{for(let t of gamePlayers)if($.id===t.id){let i=t.x-700-50,o=t.y-460-50,s=new Hitbox(i,o,1450,970),l=[],a=[];for(let n=0;n<GameObjects.blocks.length;n++){let r=GameObjects.blocks[n];Math.max(r.x-t.x,t.x-r.x)+Math.max(r.y-t.y,t.y-r.y)<1800&&a.push(r)}for(let m=0;m<a.length;m++){let c=a[m];checkCollisionWith(c.hitbox,s)&&l.push(c)}$.emit("send-blocks",l),$.emit("send-blocks-stats",convertNumberToPercent(a.length,GameObjects.blocks.length).toFixed(2))}}),$.on("ping",$=>{$()}),$.on("disconnect",function(){let e=-1;console.log("User close. User ID:"+$.id+"."),gamePlayers.forEach((t,i)=>{$.id===t.id&&(e=i,console.log("User close. User in array:"+i+"."))})})}),setInterval(playerLoop,15),setInterval(bulletsLoop,35),setInterval(gameLoop,25),setInterval(timeLoop,1,gameTimer);